<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>
    devNotes | CSS 3D - Scrolling on the z-axis
  </title>
  <meta name="description" content="Collection of things I learned around web development.
" />
  <meta name="author" content="Vincent Humeau" />
  <link rel="manifest" href="/devNotes/manifest.json" />
  
  <link rel="canonical" href="" />
  
  <link
    rel="apple-touch-icon"
    sizes="180x180"
    href="/devNotes/dist/img/icons/apple-touch-icon.png"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="/devNotes/dist/img/icons/favicon-32x32.png"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="16x16"
    href="/devNotes/dist/img/icons/favicon-16x16.png"
  />
  <link
    rel="mask-icon"
    href="/devNotes/dist/img/icons/safari-pinned-tab.svg"
    color="#212121"
  />
  <link
    rel="shortcut icon"
    href="/devNotes/dist/img/icons/favicon.ico"
  />
  <meta name="msapplication-TileColor" content="#212121" />
  <meta
    name="msapplication-config"
    content="/devNotes/dist/img/icons/browserconfig.xml"
  />
  <meta name="theme-color" content="#212121" />

  <link rel="stylesheet" href="/devNotes/dist/css/screen.min.css" />
  <link
    href="https://fonts.googleapis.com/css?family=Asap:400,700"
    rel="stylesheet"
  />
</head>
<body>
    <div class="page-wrapper">
      <header class="page-header">
        <p>
          <a class="site-title" href="/devNotes/">devNotes</a> <small>by <a href="https://www.vincent-humeau.com" rel="author">Vincent Humeau</a></small>
        </p>
      </header>
      <main class="page-content" aria-label="Content">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 itemprop="name headline">CSS 3D - Scrolling on the z-axis</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-03-21T00:00:00+00:00" itemprop="datePublished">Mar 21, 2019
      </time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><img src="/devNotes/dist/img/css3d-z-scroll-demo.gif" alt="Demo gif" /></p>

<p>In this article, we are going to create a small 3D scene, where the user can scroll on the z-axis. You can find the final code of this tutorial on <a href="https://github.com/vinceumo/CSS-3D-Scrolling-z-axis-demo/">github</a>, and the demo if you follow this <a href="https://vinceumo.github.io/CSS-3D-Scrolling-z-axis-demo/">link</a>.</p>

<p>This article assumes that you already have some knowledge about CSS and JS. We are going to use CSS custom properties, if you are not familiar with this you can read <a href="https://vinceumo.github.io/devNotes/css/2019/02/20/css-customs-properties.html">CSS custom properties - Cheatsheet</a>.</p>

<h2 id="introduction-to-css-3d">Introduction to CSS 3D</h2>

<p>When speaking of CSS 3D, we really speak about CSS3 transform 3D. This method allows us to use the <code class="highlighter-rouge">transform</code> CSS property to set perspective or rotation on the z-axis to our DOM elements.</p>

<blockquote>
  <p>The transform CSS property lets you rotate, scale, skew or translate an element. It modifies the coordinate space of the CSS visual formatting model.</p>

  <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform">transform - MDN</a></p>
</blockquote>

<p>To be allowed to render our Dom elements in a 3D space we need to have a look in the following properties:</p>

<ul>
  <li>Perspective</li>
  <li>Perspective origin</li>
  <li>Transform Z</li>
</ul>

<h3 id="perspective">Perspective</h3>

<p><code class="highlighter-rouge">perspective</code> is a CSS property that set the distance between z=0 and the user. The smaller is the perspective value the greater will be the distortion of our see. (Try to change the value of <code class="highlighter-rouge">scenePerspective</code> in the codePen example below).</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.container-scene</span> <span class="p">{</span>
  <span class="nl">perspective</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The value of <code class="highlighter-rouge">perspective</code> is a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/length">length unit</a>.</p>

<p><img src="/devNotes/dist/img/css3d-z-scroll-perspective1.png" alt="perspective illustration" /></p>

<p>Try to set the value of <code class="highlighter-rouge">scenePerspective</code> to 0 and 70 in the example below. You can notice that our cube get no perspective at all if its value is set to 0. If the value is set to 70, you can see a really strong distortion of the cube perspective. The smaller the perspective value is, the deeper it is.</p>

<p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="css,result" data-user="vinceumo" data-slug-hash="jdJLge" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CSS 3D perspective">
<span>See the Pen <a href="https://codepen.io/vinceumo/pen/jdJLge/">
CSS 3D perspective</a> by Vincent Humeau (<a href="https://codepen.io/vinceumo">@vinceumo</a>)
on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async="" src="https://static.codepen.io/assets/embed/ei.js"></script>

<p>To be able to render a 3D space, we need to specify <code class="highlighter-rouge">transform-style: preserve-3d;</code> on the child elements. In the above example, it set to our <code class="highlighter-rouge">.cube</code>. By default, the elements are flattened.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.container-scene</span> <span class="p">{</span>
  <span class="nl">perspective</span><span class="p">:</span> <span class="m">400px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.container-scene</span> <span class="nc">.cube</span> <span class="p">{</span>
  <span class="nl">transform-style</span><span class="p">:</span> <span class="n">preserve-3d</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="perspective-origin">Perspective origin</h3>

<blockquote>
  <p>The <code class="highlighter-rouge">perspective-origin</code> CSS property determines the position at which the viewer is looking. It is used as the vanishing point by the perspective property.</p>

  <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/perspective-origin">MDN</a></p>
</blockquote>

<p>This property basically allows us to move the vanishing point of our 3D scene.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.container-scene</span> <span class="p">{</span>
  <span class="nl">perspective</span><span class="p">:</span> <span class="m">400px</span><span class="p">;</span>
  <span class="nl">perspective-origin</span><span class="p">:</span> <span class="m">50%</span> <span class="m">100%</span><span class="p">;</span> <span class="c">/*X position value, Y position value*/</span>
<span class="p">}</span>

<span class="nc">.container-scene</span> <span class="nc">.cube</span> <span class="p">{</span>
  <span class="nl">transform-style</span><span class="p">:</span> <span class="n">preserve-3d</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For both x and y we can set the position using percentages. but we can as well use the following values:</p>

<ul>
  <li>x position:
    <ul>
      <li><code class="highlighter-rouge">left</code> = 0%</li>
      <li><code class="highlighter-rouge">center</code> = 50%</li>
      <li><code class="highlighter-rouge">right</code> = 100%</li>
    </ul>
  </li>
  <li>y position
    <ul>
      <li><code class="highlighter-rouge">top</code> = 0%</li>
      <li><code class="highlighter-rouge">center</code> = 50%</li>
      <li><code class="highlighter-rouge">bottom</code> = 50%</li>
    </ul>
  </li>
</ul>

<p><img src="/devNotes/dist/img/css3d-z-scroll-perspective-origin.png" alt="Perspective origin illustration" /></p>

<p>In the following example, you can change the value of <code class="highlighter-rouge">perspectiveOriginX</code> and <code class="highlighter-rouge">perspectiveOriginY</code>.</p>

<p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="css,result" data-user="vinceumo" data-slug-hash="wOwzBY" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CSS 3D perspective origin">
<span>See the Pen <a href="https://codepen.io/vinceumo/pen/wOwzBY/">
CSS 3D perspective origin</a> by Vincent Humeau (<a href="https://codepen.io/vinceumo">@vinceumo</a>)
on <a href="https://codepen.io">CodePen</a>.</span>
</p>

<h3 id="transform-z">Transform Z</h3>

<p>We already mentioned earlier that the <code class="highlighter-rouge">transform</code> CSS property allows us to set our elements in a 3D space.</p>

<p>Transform comes with different functions to transform our elements in 3D:</p>

<ul>
  <li>rotateX(angle) - <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/rotateX">MDN</a></li>
  <li>rotateY(angle) - <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/rotateY">MDN</a></li>
  <li>rotateZ(angle) - <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/rotateZ">MDN</a></li>
  <li>translateZ(tz) - <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/translateZ">MDN</a></li>
  <li>scaleZ(sz) - <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/scaleZ">MDN</a></li>
</ul>

<p>As we saw in the illustration in the <code class="highlighter-rouge">perspective</code> section. <code class="highlighter-rouge">translateZ()</code> allows us to position an element along the z-axis of the 3D space. Alternately we can use the <code class="highlighter-rouge">translate3D(x, y, z)</code> CSS function.</p>

<p>In the following example, you can play with the Z-axis position of the <code class="highlighter-rouge">.cube</code> and <code class="highlighter-rouge">.face-</code> by changing the value of <code class="highlighter-rouge">cubeTranslateZ</code> and <code class="highlighter-rouge">cubeFacesTranslateZ</code>.</p>

<p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="css,result" data-user="vinceumo" data-slug-hash="VRZKEB" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CSS 3D Transform Z">
<span>See the Pen <a href="https://codepen.io/vinceumo/pen/VRZKEB/">
CSS 3D Transform Z</a> by Vincent Humeau (<a href="https://codepen.io/vinceumo">@vinceumo</a>)
on <a href="https://codepen.io">CodePen</a>.</span>
</p>

<h2 id="scroll-on-the-z-axis">Scroll on the z-axis</h2>

<p>Now that we have a good understanding of how CSS 3D works we are going to create a 3D scene, where we are going to be able to scroll on the z-axis.</p>

<h3 id="set-the-scene">Set the scene</h3>

<p>We are going to create a page that lists out all the films of Studio Ghibli. Each film is going to be a card positioned on the z-axis of our scene. Feel free to fork or <a href="https://codepen.io/vinceumo/share/zip/JzaXqN">download</a> the following codepen as a starter material to follow along. I’m using <a href="https://github.com/axios/axios">axios</a> with <a href="https://ghibliapi.herokuapp.com/">Studio Ghibli API</a> to populate this page.</p>

<p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="html, result" data-user="vinceumo" data-slug-hash="JzaXqN" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CSS 3d Scrolling in the z axis - Step 1">
<span>See the Pen <a href="https://codepen.io/vinceumo/pen/JzaXqN/">
CSS 3d Scrolling in the z axis - Step 1</a> by Vincent Humeau (<a href="https://codepen.io/vinceumo">@vinceumo</a>)
on <a href="https://codepen.io">CodePen</a>.</span>
</p>

<p>If you want to follow along with your own content we will need the following markup:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"viewport"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"scene3D-container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"scene3D"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div&gt;</span>Card1<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;</span>Card2<span class="nt">&lt;/div&gt;</span>
      <span class="c">&lt;!--Etc.--&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<h4 id="styling">Styling</h4>

<p>First, we are going to set our <a href="https://vinceumo.github.io/devNotes/css/2019/02/20/css-customs-properties.html">CSS custom properties</a> (CSS variables). Some of these variables are going to be transformed using JS. They are going to help us to interact with the scene.</p>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">:root</span> <span class="p">{</span>
  <span class="na">--scenePerspective</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
  <span class="na">--scenePerspectiveOriginX</span><span class="p">:</span> <span class="m">50</span><span class="p">;</span>
  <span class="na">--scenePerspectiveOriginY</span><span class="p">:</span> <span class="m">30</span><span class="p">;</span>
  <span class="na">--itemZ</span><span class="p">:</span> <span class="m">2</span><span class="p">;</span> <span class="c1">// Gap between each cards</span>
  <span class="na">--cameraSpeed</span><span class="p">:</span> <span class="m">150</span><span class="p">;</span> <span class="c1">// Where 1 is the fastest, this var is a multiplying factor of --scenePerspective and --filmZ</span>
  <span class="na">--cameraZ</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// Initial camera position</span>
  <span class="na">--viewportHeight</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// Viewport height will allow us to set the depth of our scene</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">.viewport</code> will allow us to set the height of the window. We will later use it to set the depth of the scene and use the scrollbar to navigate in the z-axis.</p>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.viewport</span> <span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="nf">calc</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">viewportHeight</span><span class="p">)</span> <span class="o">*</span> <span class="m">1px</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">.scene3D-container</code> sets the scene perspective and the perspective origin. It is position fixed so it stays always on screen. We are as well going to set the perspective origin.</p>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.viewport</span> <span class="nc">.scene3D-container</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">perspective</span><span class="p">:</span> <span class="nf">calc</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">scenePerspective</span><span class="p">)</span> <span class="o">*</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">cameraSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="m">1px</span><span class="p">);</span>
  <span class="nl">perspective-origin</span><span class="p">:</span> <span class="nf">calc</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">scenePerspectiveOriginX</span><span class="p">)</span> <span class="o">*</span> <span class="m">1%</span><span class="p">)</span> <span class="nf">calc</span><span class="p">(</span>
      <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">scenePerspectiveOriginY</span><span class="p">)</span> <span class="o">*</span> <span class="m">1%</span>
    <span class="p">);</span>
  <span class="na">will-change</span><span class="p">:</span> <span class="n">perspective-origin</span><span class="p">;</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="nf">translate3d</span><span class="p">(</span>
    <span class="m">0</span><span class="o">,</span>
    <span class="m">0</span><span class="o">,</span>
    <span class="m">0</span>
  <span class="p">);</span> <span class="c1">//Allows Hardware-Accelerated CSS, so transitions are smoother</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">.scene3D</code> sets the position of our scene on the z-axis, This will behave a bit like moving a camera on the z-axis. But really we are moving the scene and the camera (viewport) is fixed. In the rest of this article, we are going to use the camera comparison. <code class="highlighter-rouge">.scene3D</code> takes the full height and width of the viewport.</p>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.viewport</span> <span class="nc">.scene3D-container</span> <span class="nc">.scene3D</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100vh</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">transform-style</span><span class="p">:</span> <span class="n">preserve-3d</span><span class="p">;</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="nf">translateZ</span><span class="p">(</span><span class="nf">calc</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">cameraZ</span><span class="p">)</span> <span class="o">*</span> <span class="m">1px</span><span class="p">));</span>
  <span class="na">will-change</span><span class="p">:</span> <span class="n">transform</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Last but not least we are going to position our cards in the scene. All items are position absolute. Odd items are position on the left, even ones on the right.</p>

<p>We use SCSS to programmatically translate each item. On the <strong>X</strong> and <strong>Y</strong> axis we randomly translate them between -25% and 25% for X, between -50% and 50% for Y. We use a <code class="highlighter-rouge">@for</code> loop so each item can be translated on the <strong>z</strong> axis multiply by their indexes.</p>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.viewport</span> <span class="nc">.scene3D-container</span> <span class="nc">.scene3D</span> <span class="p">{</span>
  <span class="o">&gt;</span> <span class="nt">div</span> <span class="p">{</span>
    <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
    <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
    <span class="nl">top</span><span class="p">:</span> <span class="m">40%</span><span class="p">;</span>

    <span class="k">@media</span> <span class="n">only</span> <span class="n">screen</span> <span class="nf">and</span> <span class="p">(</span><span class="n">min-width</span><span class="o">:</span> <span class="m">600px</span><span class="p">)</span> <span class="p">{</span>
      <span class="nl">width</span><span class="p">:</span> <span class="m">45%</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">&amp;</span><span class="nd">:nth-child</span><span class="o">(</span><span class="nt">2n</span><span class="o">)</span> <span class="p">{</span>
      <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">&amp;</span><span class="nd">:nth-child</span><span class="o">(</span><span class="nt">2n</span> <span class="o">+</span> <span class="nt">1</span><span class="o">)</span> <span class="p">{</span>
      <span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">@for</span> <span class="nv">$i</span> <span class="ow">from</span> <span class="m">0</span> <span class="ow">through</span> <span class="m">25</span> <span class="p">{</span>
      <span class="k">&amp;</span><span class="nd">:nth-child</span><span class="o">(</span><span class="si">#{</span><span class="nv">$i</span><span class="si">}</span><span class="o">)</span> <span class="p">{</span>
        <span class="nl">transform</span><span class="p">:</span> <span class="nf">translate3D</span><span class="p">(</span>
          <span class="nf">random</span><span class="p">(</span><span class="m">50</span><span class="p">)</span> <span class="o">-</span> <span class="m">25</span> <span class="o">*</span> <span class="m">1%</span><span class="o">,</span>
          <span class="nf">random</span><span class="p">(</span><span class="m">100</span><span class="p">)</span> <span class="o">-</span> <span class="m">50</span> <span class="o">*</span> <span class="m">1%</span><span class="o">,</span>
          <span class="nf">calc</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">itemZ</span><span class="p">)</span> <span class="o">*</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">cameraSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="si">#{</span><span class="nv">$i</span><span class="si">}</span> <span class="o">*</span> <span class="m">-1px</span><span class="p">)</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The CSS is now done, we have a 3D scene. In the following parts of this article, we are going to write some javascript that going to allow us to navigate in the scene.</p>

<p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="css,result" data-user="vinceumo" data-slug-hash="WmgxBG" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CSS 3d Scrolling in the z axis - Step 2">
<span>See the Pen <a href="https://codepen.io/vinceumo/pen/WmgxBG/">
CSS 3d Scrolling in the z axis - Step 2</a> by Vincent Humeau (<a href="https://codepen.io/vinceumo">@vinceumo</a>)
on <a href="https://codepen.io">CodePen</a>.</span>
</p>

<h4 id="scrolling-on-z-axis-move-camera">Scrolling on z-axis (move camera)</h4>

<p>To be able to scroll, we need first to set the value of <code class="highlighter-rouge">--viewportHeight</code> which emulates the depth of the scene.</p>

<p>The depth of the scene is equal to the addition of the following:</p>

<ul>
  <li>The height of the user window
    <ul>
      <li>window.innerHeight</li>
    </ul>
  </li>
  <li>The <code class="highlighter-rouge">.scene3D-container</code> perspective
    <ul>
      <li><code class="highlighter-rouge">var(--scenePerspective) * var(--cameraSpeed)</code></li>
    </ul>
  </li>
  <li>The translate z value of our last item
    <ul>
      <li><code class="highlighter-rouge">var(--itemZ) * var(--cameraSpeed) * items.length</code></li>
    </ul>
  </li>
</ul>

<p>Let’s create a <code class="highlighter-rouge">setSceneHeight()</code> function that will update the value of <code class="highlighter-rouge">--viewportHeight</code> on load.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">setSceneHeight</span><span class="p">();</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">setSceneHeight</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">numberOfItems</span> <span class="o">=</span> <span class="nx">films</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="c1">// Or number of items you have in `.scene3D`</span>
  <span class="kd">const</span> <span class="nx">itemZ</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span>
    <span class="nx">getComputedStyle</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">).</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="s2">"--itemZ"</span><span class="p">)</span>
  <span class="p">);</span>
  <span class="kd">const</span> <span class="nx">scenePerspective</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span>
    <span class="nx">getComputedStyle</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">).</span><span class="nx">getPropertyValue</span><span class="p">(</span>
      <span class="s2">"--scenePerspective"</span>
    <span class="p">)</span>
  <span class="p">);</span>
  <span class="kd">const</span> <span class="nx">cameraSpeed</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span>
    <span class="nx">getComputedStyle</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">).</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="s2">"--cameraSpeed"</span><span class="p">)</span>
  <span class="p">);</span>

  <span class="kd">const</span> <span class="nx">height</span> <span class="o">=</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">+</span>
    <span class="nx">scenePerspective</span> <span class="o">*</span> <span class="nx">cameraSpeed</span> <span class="o">+</span>
    <span class="nx">itemZ</span> <span class="o">*</span> <span class="nx">cameraSpeed</span> <span class="o">*</span> <span class="nx">numberOfItems</span><span class="p">;</span>

  <span class="c1">// Update --viewportHeight value</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s2">"--viewportHeight"</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Our page has now a scrollbar, but we are still unable to scroll. We need to add an event listener that will listen to the user scrolling. The scroll event will call a <code class="highlighter-rouge">moveCamera()</code> function. It will update the value of <code class="highlighter-rouge">--cameraZ</code> with the value of <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/pageYOffset">window.pageYOffset</a>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"scroll"</span><span class="p">,</span> <span class="nx">moveCamera</span><span class="p">);</span>
  <span class="nx">setSceneHeight</span><span class="p">();</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">moveCamera</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s2">"--cameraZ"</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">setSceneHeight</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="js,result" data-user="vinceumo" data-slug-hash="pYxpLW" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CSS 3d Scrolling in the z axis - Step 3">
<span>See the Pen <a href="https://codepen.io/vinceumo/pen/pYxpLW/">
CSS 3d Scrolling in the z axis - Step 3</a> by Vincent Humeau (<a href="https://codepen.io/vinceumo">@vinceumo</a>)
on <a href="https://codepen.io">CodePen</a>.</span>
</p>

<h4 id="move-camera-angle">Move camera angle</h4>

<p>Finally, let’s make our scene a bit more dynamic. On <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/mousemove_event">mousemove event</a> we are going to change the values of <code class="highlighter-rouge">scenePerspectiveOriginX</code> and <code class="highlighter-rouge">scenePerspectiveOriginY</code>. This will give the illusion that the camera move. The items will stay straight in the scene. If you want to give a more realistic camera rotation movement, you could apply <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/rotate3d">rotate3d()</a> on the scene.</p>

<p>First, we are going to store the initial values of these two variables in a <code class="highlighter-rouge">perspectiveOrigin</code> object, we are going to set a <code class="highlighter-rouge">perspectiveOrigin.maxGap</code> value which is going to limit the maximum and minimum values of the variables. For example if <code class="highlighter-rouge">scenePerspectiveOriginY</code> is equal to 50%. On mousemove, the new value will be between 40% and 60%.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">perspectiveOrigin</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">x</span><span class="p">:</span> <span class="nb">parseFloat</span><span class="p">(</span>
    <span class="nx">getComputedStyle</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">).</span><span class="nx">getPropertyValue</span><span class="p">(</span>
      <span class="s2">"--scenePerspectiveOriginX"</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="na">y</span><span class="p">:</span> <span class="nb">parseFloat</span><span class="p">(</span>
    <span class="nx">getComputedStyle</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">).</span><span class="nx">getPropertyValue</span><span class="p">(</span>
      <span class="s2">"--scenePerspectiveOriginY"</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="na">maxGap</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">};</span>
</code></pre></div></div>

<p>If the user cursor is at the centre of the screen, we will set the values of <code class="highlighter-rouge">--scenePerspectiveOriginX</code> and <code class="highlighter-rouge">--scenePerspectiveOriginX</code> as the initial ones. The further the cursor moves away from the centre, the bigger will increase/decrease these values. If the user moves to the top left corner the values will increase, on the bottom right corner they will decrease.</p>

<p>The <code class="highlighter-rouge">moveCameraAngle()</code> function is going to update the values:</p>

<ul>
  <li><code class="highlighter-rouge">xGap</code> and <code class="highlighter-rouge">yGap</code> return the mouse position of the user in percentage on the X and Y axis, compare to the centre of the window.</li>
  <li><code class="highlighter-rouge">newPerspectiveOriginX</code> and <code class="highlighter-rouge">newPerspectiveOriginY</code> return the new perspective origin.</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"scroll"</span><span class="p">,</span> <span class="nx">moveCamera</span><span class="p">);</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"mousemove"</span><span class="p">,</span> <span class="nx">moveCameraAngle</span><span class="p">);</span>
  <span class="nx">setSceneHeight</span><span class="p">();</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">moveCameraAngle</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">xGap</span> <span class="o">=</span>
    <span class="p">(((</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span>
      <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">yGap</span> <span class="o">=</span>
    <span class="p">(((</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span>
      <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">newPerspectiveOriginX</span> <span class="o">=</span>
    <span class="nx">perspectiveOrigin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">xGap</span> <span class="o">*</span> <span class="nx">perspectiveOrigin</span><span class="p">.</span><span class="nx">maxGap</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">newPerspectiveOriginY</span> <span class="o">=</span>
    <span class="nx">perspectiveOrigin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">yGap</span> <span class="o">*</span> <span class="nx">perspectiveOrigin</span><span class="p">.</span><span class="nx">maxGap</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>

  <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span>
    <span class="s2">"--scenePerspectiveOriginX"</span><span class="p">,</span>
    <span class="nx">newPerspectiveOriginX</span>
  <span class="p">);</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span>
    <span class="s2">"--scenePerspectiveOriginY"</span><span class="p">,</span>
    <span class="nx">newPerspectiveOriginY</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="js,result" data-user="vinceumo" data-slug-hash="NJEwwo" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CSS 3d Scrolling in the z axis - Step 4">
<span>See the Pen <a href="https://codepen.io/vinceumo/pen/NJEwwo/">
CSS 3d Scrolling in the z axis - Step 4</a> by Vincent Humeau (<a href="https://codepen.io/vinceumo">@vinceumo</a>)
on <a href="https://codepen.io">CodePen</a>.</span>
</p>

<p>Our scene is now finished 🎉. I hope you enjoyed this article 😃</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://tympanus.net/codrops/css_reference/perspective/">perspective - Codrops</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/perspective">perspective - MDN</a></li>
  <li><a href="https://tympanus.net/codrops/css_reference/transform-style/">transform-style - Codrops</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-style">transform-style - MDN</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/perspective-origin">perspective-origin - MDN</a></li>
  <li><a href="https://css-tricks.com/things-watch-working-css-3d/">Things to Watch Out for When Working with CSS 3D - CSS-tricks</a></li>
</ul>

<hr />

<ul>
  <li><a href="https://twitter.com/vince_umo">Follow me on twitter</a></li>
  <li><a href="https://github.com/vinceumo">Follow me on Github</a></li>
  <li><a href="https://dev.to/vinceumo">Follow me on dev.to</a></li>
</ul>

  </div>

  <a class="u-url" href="/devNotes/css/2019/03/21/css-3d-scrolling-on-the-z-axis.html" hidden></a>
</article>
      </main>
      <footer>
        <p>Hello world, I'm Vince 😃 Lead Front End Developer <a href="https://www.damdigital.com/">@ DAM Digital 🚀</a></p>
        <p>🌍 London, UK</p>
        <ul class="links">
          <li><a href="/devNotes/feed.xml">RSS</a></li>
          <li><a href="https://vincent-humeau.com/">vincent-humeau.com</a></li>
          <li><a href="https://github.com/vinceumo/devNotes">Check this project on github</a></li>
        </ul>
        <button class="toggle-theme" data-toggle-theme="theme-dark">Dark theme</button>
        <button class="toggle-theme" data-toggle-theme="theme-default">Light theme</button>
      </footer>
    </div>
    <script src="/devNotes/dist/js/scriptsBundleMain.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/devNotes/sw.js');
        });
      }
    </script>
    <script src="https://cdn.jsdelivr.net/gh/ireade/caniuse-embed/caniuse-embed.min.js"></script>
  </body>
</html>